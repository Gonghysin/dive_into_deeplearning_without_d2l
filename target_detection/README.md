# TinyDetector - è½»é‡çº§ç›®æ ‡æ£€æµ‹å™¨

åŸºäº VGG16 å’Œ SSD æ€æƒ³çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œç”¨äº Pascal VOC æ•°æ®é›†ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
target_detection/
â”œâ”€â”€ model.py              # æ¨¡å‹å®šä¹‰ï¼ˆVGGBase, PredictionConvolutions, TinyDetector, MultiBoxLossï¼‰
â”œâ”€â”€ datasets.py           # æ•°æ®é›†åŠ è½½å™¨
â”œâ”€â”€ utils.py              # å·¥å…·å‡½æ•°
â”œâ”€â”€ train.py              # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ detect.py             # æ£€æµ‹å’Œå¯è§†åŒ–è„šæœ¬
â”œâ”€â”€ create_data_lists.py  # æ•°æ®é¢„å¤„ç†è„šæœ¬
â””â”€â”€ results/              # ç»“æœä¿å­˜ç›®å½•
    â”œâ”€â”€ checkpoints/      # æ¨¡å‹æ£€æŸ¥ç‚¹
    â”œâ”€â”€ plots/            # è®­ç»ƒæ›²çº¿å›¾
    â””â”€â”€ detections/       # æ£€æµ‹ç»“æœå›¾
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å‡†å¤‡æ•°æ®

é¦–å…ˆä¸‹è½½ Pascal VOC 2007 å’Œ 2012 æ•°æ®é›†ï¼Œç„¶åè¿è¡Œæ•°æ®é¢„å¤„ç†è„šæœ¬ï¼š

```bash
python create_data_lists.py
```

### 2. è®­ç»ƒæ¨¡å‹

è¿è¡Œè®­ç»ƒè„šæœ¬ï¼š

```bash
python train.py
```

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šï¼š
- è‡ªåŠ¨è¿›è¡Œè®­ç»ƒå’ŒéªŒè¯
- æ¯ 10 ä¸ª epoch ä¿å­˜ä¸€æ¬¡æ£€æŸ¥ç‚¹
- ä¿å­˜éªŒè¯æŸå¤±æœ€ä½çš„æœ€ä½³æ¨¡å‹
- æ¯ 5 ä¸ª epoch æ›´æ–°è®­ç»ƒæ›²çº¿å›¾

**è®­ç»ƒç»“æœä¿å­˜ä½ç½®ï¼š**
- æ¨¡å‹æ£€æŸ¥ç‚¹: `results/checkpoints/`
  - `checkpoint_latest.pth` - æœ€æ–°æ£€æŸ¥ç‚¹
  - `checkpoint_epoch_*.pth` - æ¯ 10 ä¸ª epoch çš„æ£€æŸ¥ç‚¹
  - `best_model.pth` - æœ€ä½³æ¨¡å‹
- è®­ç»ƒæ›²çº¿: `results/plots/training_curves.png`

### 3. æ£€æµ‹æ¨ç†

#### æ£€æµ‹å•å¼ å›¾åƒ

```bash
python detect.py --checkpoint results/checkpoints/best_model.pth \
                 --image path/to/image.jpg \
                 --output_dir results/detections
```

#### æ‰¹é‡æ£€æµ‹

```bash
python detect.py --checkpoint results/checkpoints/best_model.pth \
                 --image_dir path/to/images/ \
                 --output_dir results/detections
```

#### å‚æ•°è¯´æ˜

- `--checkpoint`: æ¨¡å‹æ£€æŸ¥ç‚¹è·¯å¾„ï¼ˆå¿…éœ€ï¼‰
- `--image`: å•å¼ å›¾åƒè·¯å¾„
- `--image_dir`: å›¾åƒç›®å½•ï¼ˆæ‰¹é‡æ£€æµ‹ï¼‰
- `--output_dir`: è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ï¼š`results/detections`ï¼‰
- `--min_score`: æœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆé»˜è®¤ï¼š0.2ï¼‰
- `--max_overlap`: NMS IoU é˜ˆå€¼ï¼ˆé»˜è®¤ï¼š0.45ï¼‰
- `--top_k`: æœ€å¤šä¿ç•™çš„æ£€æµ‹æ¡†æ•°é‡ï¼ˆé»˜è®¤ï¼š200ï¼‰

## ğŸ“Š è®­ç»ƒå¯è§†åŒ–

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ç”Ÿæˆè®­ç»ƒæ›²çº¿å›¾ï¼ŒåŒ…æ‹¬ï¼š

1. **æŸå¤±æ›²çº¿**: è®­ç»ƒæŸå¤±å’ŒéªŒè¯æŸå¤±éš epoch çš„å˜åŒ–
2. **å­¦ä¹ ç‡æ›²çº¿**: å­¦ä¹ ç‡çš„è¡°å‡æƒ…å†µ

å¯è§†åŒ–å›¾ä¿å­˜åœ¨ `results/plots/training_curves.png`

## ğŸ¯ æ¨¡å‹æ¶æ„

### ç½‘ç»œç»“æ„

```
è¾“å…¥å›¾åƒ (224Ã—224Ã—3)
    â†“
VGGBase (ç‰¹å¾æå–)
    â†“
ç‰¹å¾å›¾ (7Ã—7Ã—512)
    â†“
PredictionConvolutions (é¢„æµ‹å¤´)
    â†“
â”œâ”€ ä½ç½®åç§» (441, 4)
â””â”€ ç±»åˆ«åˆ†æ•° (441, 21)
```

### å…ˆéªŒæ¡†è®¾è®¡

- ç‰¹å¾å›¾: 7Ã—7
- æ¯ä¸ªä½ç½®çš„å…ˆéªŒæ¡†: 9 ä¸ª
  - å°ºåº¦: [0.2, 0.4, 0.6]
  - å®½é«˜æ¯”: [1.0, 2.0, 0.5]
- æ€»å…ˆéªŒæ¡†æ•°: 7Ã—7Ã—9 = 441

## ğŸ“ˆ è®­ç»ƒå‚æ•°

- **æ€» Epoch æ•°**: 230
- **æ‰¹æ¬¡å¤§å°**: 32
- **åˆå§‹å­¦ä¹ ç‡**: 0.001
- **å­¦ä¹ ç‡è¡°å‡**: 
  - åœ¨ epoch 150 å’Œ 190 è¡°å‡
  - è¡°å‡ç³»æ•°: 0.1
- **ä¼˜åŒ–å™¨**: SGD
  - åŠ¨é‡: 0.9
  - æƒé‡è¡°å‡: 5e-4

## ğŸ¨ æ£€æµ‹ç»“æœ

æ£€æµ‹ç»“æœä¼šæ˜¾ç¤ºï¼š
- å½©è‰²è¾¹ç•Œæ¡†ï¼ˆä¸åŒç±»åˆ«ä¸åŒé¢œè‰²ï¼‰
- ç±»åˆ«æ ‡ç­¾å’Œç½®ä¿¡åº¦åˆ†æ•°

æ‰€æœ‰æ£€æµ‹ç»“æœä¿å­˜åœ¨ `results/detections/` ç›®å½•ã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®è·¯å¾„**: ä¿®æ”¹ `train.py` ä¸­çš„ `data_folder` ä¸ºä½ çš„æ•°æ®é›†è·¯å¾„
2. **æ˜¾å­˜è¦æ±‚**: é»˜è®¤æ‰¹æ¬¡å¤§å°ä¸º 32ï¼Œå¦‚æœæ˜¾å­˜ä¸è¶³å¯ä»¥å‡å°
3. **è®­ç»ƒæ—¶é—´**: å®Œæ•´è®­ç»ƒ 230 ä¸ª epoch éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®ä½¿ç”¨ GPU
4. **ä¸­æ–‡å­—ä½“**: å¯è§†åŒ–ä½¿ç”¨ Hiragino Sans GB å­—ä½“ï¼Œå¦‚éœ€æ›´æ”¹è¯·ä¿®æ”¹å¯¹åº”æ–‡ä»¶

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹è®­ç»ƒå‚æ•°

ç¼–è¾‘ `train.py` ä¸­çš„å‚æ•°ï¼š

```python
total_epochs = 230      # æ€»è®­ç»ƒè½®æ•°
batch_size = 32         # æ‰¹æ¬¡å¤§å°
lr = 1e-3              # å­¦ä¹ ç‡
decay_lr_at = [150, 190]  # å­¦ä¹ ç‡è¡°å‡çš„ epoch
```

### ä¿®æ”¹æ£€æµ‹é˜ˆå€¼

åœ¨æ¨ç†æ—¶è°ƒæ•´å‚æ•°ï¼š

```bash
python detect.py --min_score 0.5 --max_overlap 0.3
```

## ğŸ“š å‚è€ƒ

- æ¨¡å‹è®¾è®¡å‚è€ƒ SSD (Single Shot MultiBox Detector)
- éª¨å¹²ç½‘ç»œ: VGG16
- æŸå¤±å‡½æ•°: MultiBox Loss (å®šä½æŸå¤± + åˆ†ç±»æŸå¤±)
- éš¾è´Ÿæ ·æœ¬æŒ–æ˜ (Hard Negative Mining)

---

**ä½œè€…**: TinyDetector é¡¹ç›®
**æœ€åæ›´æ–°**: 2025

